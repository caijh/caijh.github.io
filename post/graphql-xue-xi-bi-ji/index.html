
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>GraphQL学习笔记 | John&#39;s Blog</title>
<meta name="description" content="搬砖大佬">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://caijh.github.io//favicon.ico?v=1561344303565">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://caijh.github.io//styles/main.css">


  

  
    <link rel="stylesheet" href="https://unpkg.com/disqusjs@1.1/dist/disqusjs.css" />
  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



  </head>
  <body>
    <div id="app" class="main">
      <div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://caijh.github.io/">
        <img class="avatar" src="https://caijh.github.io//images/avatar.png?v=1561344303565" alt="" width="32px" height="32px">
      </a>
      <a href="https://caijh.github.io/">
        <h1 class="site-title">John&#39;s Blog</h1>
      </a>
    </div>
    <div class="right">
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }" @click="menuVisible = !menuVisible"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      
        
          <a href="/" class="menu purple-link">
            首页
          </a>
        
      
        
          <a href="/archives" class="menu purple-link">
            归档
          </a>
        
      
        
          <a href="/tags" class="menu purple-link">
            标签
          </a>
        
      
        
          <a href="/post/about" class="menu purple-link">
            关于
          </a>
        
      
    </div>
  </div>
</transition>


      <div class="content-container">
        <div class="post-detail">
          
            <div class="feature-container" style="background-image: url('https://graphql.org/img/logo.svg')">
            </div>
          
          <h2 class="post-title">GraphQL学习笔记</h2>
          <div class="post-info post-detail-info">
            <span><i class="icon-calendar-outline"></i> 2019-06-24</span>
            
              <span>
                <i class="icon-pricetags-outline"></i>
                
                  <a href="https://caijh.github.io//tag/nFkZ3G6Fh">
                    Java
                    
                  </a>
                
              </span>
            
          </div>
          <div class="post-content">
            <h2 id="graphql是什么">GraphQL是什么？</h2>
<p>GraphQl官方的定义是：</p>
<p>GraphQL是一种API的查询语言。 它用于运行时完成数据查询。 GraphQL服务与传输无关，但通常通过HTTP提供。</p>
<p>GraphQl特性</p>
<ul>
<li>GraphQL query， 只请求需要的数据</li>
<li>GraphQL schema， 在服务器端定义了api的数据结构</li>
<li>可以在一个请求中获取多个数据，如果是rest的话， 需要访问多个接口</li>
</ul>
<p>与REST对比，REST的缺点的主要有以下:</p>
<ul>
<li>Overfetching 往往会给客户端返回过多的数据</li>
<li>endpoints过多，管理endpoints是个问题。Endpoints修改，客户端也需要修改。</li>
</ul>
<!-- more -->
<p>GraphQL只是一种协议， 官方提供了多种实现。如java, javascript.</p>
<p>GraphQL中的类型</p>
<ul>
<li>
<p>scalar type</p>
<p>GraphQL的Scalar Type有Int, String, Float, Boolean, ID</p>
</li>
<li>
<p>object type</p>
</li>
<li>
<p>Fragments</p>
<pre><code class="language-java">fragment liftInfo on Lift {
  name
  status
  capacity
  night
  elevationGain
}
</code></pre>
<pre><code class="language-java">query {
    Lift(id: &quot;jazz-cat&quot;) {
      ...liftInfo
      trailAccess {
        name
        difficulty
      }
    }
    Trail(id: &quot;river-run&quot;) {
      name
      difficulty
      accessedByLifts {
        ...liftInfo
      }
    }
}
</code></pre>
<p>The fragment in this example is named <code>liftInfo</code>, and it is a selection set on the <code>Lift</code> type.</p>
</li>
<li>
<p>union type</p>
<pre><code class="language-java">union AgendaItem = StudyGroup | Workout

type StudyGroup {
    name: String!
    subject: String
    students: [User!]!
}

type Workout {
    name: String!
    reps: Int!
}

type Query {
    agenda: [AgendaItem!]!
}

</code></pre>
</li>
<li>
<p>interface</p>
<p><em>Interfaces</em> are another option when dealing with multiple object types that could be returned by a single field. An interface is an abstract type that establishes a list of fields that should be implemented in similar object types. When another type implements the interface, it includes all of the fields from the interface and usually some of its own fields.</p>
<pre><code class="language-java">interface AgendaItem {
    name: String!
    start: DateTime!
    end: DateTime!
}

type StudyGroup implements AgendaItem {
    name: String!
    start: DateTime!
    end: DateTime!
    participants: [User!]!
    topic: String!
}

type Workout implements AgendaItem {
    name: String!
    start: DateTime!
    end: DateTime!
    reps: Int!
}

type Query {
    agenda: [AgendaItem!]!
}
</code></pre>
</li>
<li>
<p>enums</p>
<pre><code class="language-java">enum PhotoCategory {
    SELFIE
    PORTRAIT
    ACTION
    LANDSCAPE
    GRAPHIC
}
</code></pre>
<pre><code class="language-java">type Photo {
    id: ID!
    name: String!
    url: String!
    description: String
    created: DateTime!
    category: PhotoCategory!
}
</code></pre>
</li>
</ul>
<h2 id="graphql的java使用">GraphQL的Java使用</h2>
<p>源码地址：<a href="https://github.com/caijh/samples/tree/master/sample-graphql">https://github.com/caijh/samples/tree/master/sample-graphql</a></p>
<ol>
<li>
<p>引入maven依赖</p>
<pre><code class="language-java">&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphql-java&lt;/artifactId&gt;
    &lt;version&gt;11.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;dependency&gt;
            &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
            &lt;artifactId&gt;graphql-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;5.0.2&lt;/version&gt;
 &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
            &lt;artifactId&gt;graphql-java-tools&lt;/artifactId&gt;
            &lt;version&gt;5.2.4&lt;/version&gt;
        &lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.graphql-java&lt;/groupId&gt;
    &lt;artifactId&gt;graphiql-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;5.0.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>建立表</p>
<pre><code class="language-mysql">create table `author` (
	id bigint primary key auto_increment,
    name varchar(45) not null,
    birthday datetime default null
) engine = InnoDB default charset=utf8 comment '作者';

create table `article` (
	id bigint primary key auto_increment,
    title varchar(100) not null,
    author_id bigint not null,
    content text not null
) engine = InnoDB default charset = utf8 comment '文章';

</code></pre>
</li>
<li>
<p>创建graphqls</p>
<p>schema.graphql</p>
<pre><code class="language-java">scalar Date

type Query {

}

type Mutation {

}
</code></pre>
<p>author.graphqls</p>
<pre><code class="language-java">extend type  Query {
    findAuthorById(id: Int): Author
}

extend type Mutation {
    newAuthor(name: String, birthday: Date): Boolean
}

type Author {
    id: ID
    name: String
    birthday: Date
}

</code></pre>
<p>article.graphqls</p>
<pre><code class="language-java">extend type Query {
    findArticleById(id: Int) : Article
}

extend type Mutation {
    newArticle(title: String, content: String, authorId: Int): Boolean
}

type Article {
    id: ID
    title: String
    content: String
    authorId: Int
}
</code></pre>
</li>
<li>
<p>创建Query和Mutation</p>
<pre><code class="language-java">package com.coding.sample.graphql.component;

import com.coding.sample.graphql.entity.Article;
import com.coding.sample.graphql.entity.Author;
import com.coding.sample.graphql.mapper.ArticleMapper;
import com.coding.sample.graphql.mapper.AuthorMapper;
import com.coxautodev.graphql.tools.GraphQLQueryResolver;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component
public class Query implements GraphQLQueryResolver {

    @Autowired
    private AuthorMapper authorMapper;
    @Autowired
    private ArticleMapper articleMapper;

    public Author findAuthorById(Long id) {
        return authorMapper.selectByPrimaryKey(id);
    }

    public Article findArticleById(Long id) {
        return articleMapper.selectByPrimaryKey(id);
    }

}
</code></pre>
<pre><code class="language-java">package com.coding.sample.graphql.component;

import java.util.Date;

import com.coding.sample.graphql.entity.Article;
import com.coding.sample.graphql.entity.Author;
import com.coding.sample.graphql.mapper.ArticleMapper;
import com.coding.sample.graphql.mapper.AuthorMapper;
import com.coxautodev.graphql.tools.GraphQLMutationResolver;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component
public class Mutation implements GraphQLMutationResolver {

    @Autowired
    private AuthorMapper authorMapper;
    @Autowired
    private ArticleMapper articleMapper;

    public boolean newAuthor(String name, Date birthday) {
        Author author = new Author();
        author.setName(name);
        author.setBirthday(birthday);
        return authorMapper.insert(author) &gt; 0;
    }

    public boolean newArticle(String title, String content, Long authorId) {
        Article article = new Article();
        article.setTitle(title);
        article.setContent(content);
        article.setAuthorId(authorId);
        articleMapper.insert(article);
        return true;
    }

}
</code></pre>
</li>
<li>
<p>测试</p>
</li>
</ol>
<p><img src="https://caijh.github.io//post-images/1561343905414.png" alt="">
<img src="https://caijh.github.io//post-images/1561343911617.png" alt=""></p>

          </div>
        </div>

        
      </div>

      
        

        
          <div id="disqus_thread"></div>
        
      

      <div class="site-footer">
  <div class="slogan">搬砖大佬</div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://caijh.github.io//atom.xml" target="_blank">RSS</a>
</div>


    </div>
    <script type="application/javascript">

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  

  
    <script src="https://unpkg.com/disqusjs@1.1/dist/disqus.js"></script>
    <script>

    var options = {
      shortname: 'disqus_2iTh58mKZo',
      apikey: 'lO2xchFAyPIP4VOKbgm796D9jIvqLVziAqLHOPnOZySwUlyWXAhgwrIbPQ16AyUX',
    }
    if ('') {
      options.api = ''
    }
    var dsqjs = new DisqusJS(options)

    </script>
  




  </body>
</html>
